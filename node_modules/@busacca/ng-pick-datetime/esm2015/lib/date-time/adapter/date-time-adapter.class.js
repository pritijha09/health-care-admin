/**
 * date-time-adapter.class
 */
import { Subject } from 'rxjs';
import { inject, InjectionToken, LOCALE_ID } from '@angular/core';
/** InjectionToken for date time picker that can be used to override default locale code. */
export const OWL_DATE_TIME_LOCALE = new InjectionToken('OWL_DATE_TIME_LOCALE', {
    providedIn: 'root',
    factory: OWL_DATE_TIME_LOCALE_FACTORY,
});
/** @docs-private */
export function OWL_DATE_TIME_LOCALE_FACTORY() {
    return inject(LOCALE_ID);
}
/** Provider for OWL_DATE_TIME_LOCALE injection token. */
export const OWL_DATE_TIME_LOCALE_PROVIDER = { provide: OWL_DATE_TIME_LOCALE, useExisting: LOCALE_ID };
export class DateTimeAdapter {
    constructor() {
        /** A stream that emits when the locale changes. */
        this._localeChanges = new Subject();
        /** total milliseconds in a day. */
        this.millisecondsInDay = 86400000;
        /** total milliseconds in a minute. */
        this.milliseondsInMinute = 60000;
    }
    get localeChanges() {
        return this._localeChanges;
    }
    /**
     * Compare two given dates
     * @return {number} -- 1, 0 or -1
     * 1 if the first date is after the second,
     * -1 if the first date is before the second
     * 0 if dates are equal.
     * */
    compare(first, second) {
        if (!this.isValid(first) || !this.isValid(second)) {
            throw Error('JSNativeDate: Cannot compare invalid dates.');
        }
        const dateFirst = this.clone(first);
        const dateSecond = this.clone(second);
        const diff = this.getTime(dateFirst) - this.getTime(dateSecond);
        if (diff < 0) {
            return -1;
        }
        else if (diff > 0) {
            return 1;
        }
        else {
            // Return 0 if diff is 0; return NaN if diff is NaN
            return diff;
        }
    }
    /**
     * Check if two given dates are in the same year
     * @return {number} -- 1, 0 or -1
     * 1 if the first date's year is after the second,
     * -1 if the first date's year is before the second
     * 0 if two given dates are in the same year
     * */
    compareYear(first, second) {
        if (!this.isValid(first) || !this.isValid(second)) {
            throw Error('JSNativeDate: Cannot compare invalid dates.');
        }
        const yearLeft = this.getYear(first);
        const yearRight = this.getYear(second);
        const diff = yearLeft - yearRight;
        if (diff < 0) {
            return -1;
        }
        else if (diff > 0) {
            return 1;
        }
        else {
            return 0;
        }
    }
    /**
     * Attempts to deserialize a value to a valid date object. This is different from parsing in that
     * deserialize should only accept non-ambiguous, locale-independent formats (e.g. a ISO 8601
     * string). The default implementation does not allow any deserialization, it simply checks that
     * the given value is already a valid date object or null. The `<mat-datepicker>` will call this
     * method on all of it's `@Input()` properties that accept dates. It is therefore possible to
     * support passing values from your backend directly to these properties by overriding this method
     * to also deserialize the format used by your backend.
     * @param value The value to be deserialized into a date object.
     * @returns The deserialized date object, either a valid date, null if the value can be
     *     deserialized into a null date (e.g. the empty string), or an invalid date.
     */
    deserialize(value) {
        if (value == null || this.isDateInstance(value) && this.isValid(value)) {
            return value;
        }
        return this.invalid();
    }
    /**
     * Sets the locale used for all dates.
     * @param locale The new locale.
     */
    setLocale(locale) {
        this.locale = locale;
        this._localeChanges.next();
    }
    /**
     * Clamp the given date between min and max dates.
     * @param date The date to clamp.
     * @param min The minimum value to allow. If null or omitted no min is enforced.
     * @param max The maximum value to allow. If null or omitted no max is enforced.
     * @returns `min` if `date` is less than `min`, `max` if date is greater than `max`,
     *     otherwise `date`.
     */
    clampDate(date, min, max) {
        if (min && this.compare(date, min) < 0) {
            return min;
        }
        if (max && this.compare(date, max) > 0) {
            return max;
        }
        return date;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS10aW1lLWFkYXB0ZXIuY2xhc3MuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYnVzYWNjYS9uZy1waWNrLWRhdGV0aW1lLyIsInNvdXJjZXMiOlsibGliL2RhdGUtdGltZS9hZGFwdGVyL2RhdGUtdGltZS1hZGFwdGVyLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBQ0gsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbEUsNEZBQTRGO0FBQzVGLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFHLElBQUksY0FBYyxDQUFTLHNCQUFzQixFQUFFO0lBQ25GLFVBQVUsRUFBRSxNQUFNO0lBQ2xCLE9BQU8sRUFBRSw0QkFBNEI7Q0FDeEMsQ0FBQyxDQUFDO0FBRUgsb0JBQW9CO0FBQ3BCLE1BQU0sVUFBVSw0QkFBNEI7SUFDeEMsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVELHlEQUF5RDtBQUN6RCxNQUFNLENBQUMsTUFBTSw2QkFBNkIsR0FBRyxFQUFDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFDLENBQUM7QUFFckcsTUFBTSxPQUFnQixlQUFlO0lBQXJDO1FBS0ksbURBQW1EO1FBQ3pDLG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUsvQyxtQ0FBbUM7UUFDaEIsc0JBQWlCLEdBQUcsUUFBUSxDQUFDO1FBRWhELHNDQUFzQztRQUNuQix3QkFBbUIsR0FBRyxLQUFLLENBQUM7SUFvVm5ELENBQUM7SUE1VkcsSUFBSSxhQUFhO1FBQ2IsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQy9CLENBQUM7SUF1UEQ7Ozs7OztTQU1LO0lBQ0wsT0FBTyxDQUFFLEtBQVEsRUFBRSxNQUFTO1FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMvQyxNQUFNLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1NBQzlEO1FBRUQsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNwQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXRDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVoRSxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7WUFDVixPQUFPLENBQUMsQ0FBQyxDQUFDO1NBQ2I7YUFBTSxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7WUFDakIsT0FBTyxDQUFDLENBQUM7U0FDWjthQUFNO1lBQ0gsbURBQW1EO1lBQ25ELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7SUFDTCxDQUFDO0lBRUQ7Ozs7OztTQU1LO0lBQ0wsV0FBVyxDQUFFLEtBQVEsRUFBRSxNQUFTO1FBRTVCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMvQyxNQUFNLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1NBQzlEO1FBRUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXZDLE1BQU0sSUFBSSxHQUFHLFFBQVEsR0FBRyxTQUFTLENBQUM7UUFFbEMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUNiO2FBQU0sSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO1lBQ2pCLE9BQU8sQ0FBQyxDQUFDO1NBQ1o7YUFBTTtZQUNILE9BQU8sQ0FBQyxDQUFDO1NBQ1o7SUFDTCxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7O09BV0c7SUFDSCxXQUFXLENBQUUsS0FBVTtRQUNuQixJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3BFLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVMsQ0FBRSxNQUFXO1FBQ2xCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxTQUFTLENBQUUsSUFBTyxFQUFFLEdBQWMsRUFBRSxHQUFjO1FBQzlDLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNwQyxPQUFPLEdBQUcsQ0FBQztTQUNkO1FBQ0QsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3BDLE9BQU8sR0FBRyxDQUFDO1NBQ2Q7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogZGF0ZS10aW1lLWFkYXB0ZXIuY2xhc3NcclxuICovXHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgaW5qZWN0LCBJbmplY3Rpb25Ub2tlbiwgTE9DQUxFX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG4vKiogSW5qZWN0aW9uVG9rZW4gZm9yIGRhdGUgdGltZSBwaWNrZXIgdGhhdCBjYW4gYmUgdXNlZCB0byBvdmVycmlkZSBkZWZhdWx0IGxvY2FsZSBjb2RlLiAqL1xyXG5leHBvcnQgY29uc3QgT1dMX0RBVEVfVElNRV9MT0NBTEUgPSBuZXcgSW5qZWN0aW9uVG9rZW48c3RyaW5nPignT1dMX0RBVEVfVElNRV9MT0NBTEUnLCB7XHJcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXHJcbiAgICBmYWN0b3J5OiBPV0xfREFURV9USU1FX0xPQ0FMRV9GQUNUT1JZLFxyXG59KTtcclxuXHJcbi8qKiBAZG9jcy1wcml2YXRlICovXHJcbmV4cG9ydCBmdW5jdGlvbiBPV0xfREFURV9USU1FX0xPQ0FMRV9GQUNUT1JZKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gaW5qZWN0KExPQ0FMRV9JRCk7XHJcbn1cclxuXHJcbi8qKiBQcm92aWRlciBmb3IgT1dMX0RBVEVfVElNRV9MT0NBTEUgaW5qZWN0aW9uIHRva2VuLiAqL1xyXG5leHBvcnQgY29uc3QgT1dMX0RBVEVfVElNRV9MT0NBTEVfUFJPVklERVIgPSB7cHJvdmlkZTogT1dMX0RBVEVfVElNRV9MT0NBTEUsIHVzZUV4aXN0aW5nOiBMT0NBTEVfSUR9O1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIERhdGVUaW1lQWRhcHRlcjxUPiB7XHJcblxyXG4gICAgLyoqIFRoZSBsb2NhbGUgdG8gdXNlIGZvciBhbGwgZGF0ZXMuICovXHJcbiAgICBwcm90ZWN0ZWQgbG9jYWxlOiBhbnk7XHJcblxyXG4gICAgLyoqIEEgc3RyZWFtIHRoYXQgZW1pdHMgd2hlbiB0aGUgbG9jYWxlIGNoYW5nZXMuICovXHJcbiAgICBwcm90ZWN0ZWQgX2xvY2FsZUNoYW5nZXMgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG4gICAgZ2V0IGxvY2FsZUNoYW5nZXMoKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsZUNoYW5nZXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIHRvdGFsIG1pbGxpc2Vjb25kcyBpbiBhIGRheS4gKi9cclxuICAgIHByb3RlY3RlZCByZWFkb25seSBtaWxsaXNlY29uZHNJbkRheSA9IDg2NDAwMDAwO1xyXG5cclxuICAgIC8qKiB0b3RhbCBtaWxsaXNlY29uZHMgaW4gYSBtaW51dGUuICovXHJcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgbWlsbGlzZW9uZHNJbk1pbnV0ZSA9IDYwMDAwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSB5ZWFyIG9mIHRoZSBnaXZlbiBkYXRlXHJcbiAgICAgKiBAcGFyYW0gZGF0ZVxyXG4gICAgICogQHJldHVybiB7bnVtYmVyfVxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IGdldFllYXIoIGRhdGU6IFQgKTogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSBtb250aCBvZiB0aGUgZ2l2ZW4gZGF0ZVxyXG4gICAgICogQHBhcmFtIGRhdGVcclxuICAgICAqIEByZXR1cm4ge251bWJlcn0gLS0gZnJvbSAwLTExXHJcbiAgICAgKiAwIC0tIEphbnVhcnlcclxuICAgICAqIDExIC0tIERlY2VtYmVyXHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3QgZ2V0TW9udGgoIGRhdGU6IFQgKTogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSBkYXkgb2YgdGhlIHdlZWsgb2YgdGhlIGdpdmVuIGRhdGVcclxuICAgICAqIEBwYXJhbSBkYXRlXHJcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IC0tIGZyb20gMC02XHJcbiAgICAgKiAwIC0tIFN1bmRheVxyXG4gICAgICogNiAtLSBTYXR1cmRheVxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IGdldERheSggZGF0ZTogVCApOiBudW1iZXI7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIGRheSBudW0gb2YgdGhlIGdpdmVuIGRhdGVcclxuICAgICAqIEBwYXJhbSBkYXRlXHJcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IC0tIGZyb20gMS0zMVxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IGdldERhdGUoIGRhdGU6IFQgKTogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSBob3VycyBvZiB0aGUgZ2l2ZW4gZGF0ZVxyXG4gICAgICogQHBhcmFtIGRhdGVcclxuICAgICAqIEByZXR1cm4ge251bWJlcn0gLS0gZnJvbSAwLTIzXHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3QgZ2V0SG91cnMoIGRhdGU6IFQgKTogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSBtaW51dGVzIG9mIHRoZSBnaXZlbiBkYXRlXHJcbiAgICAgKiBAcGFyYW0gZGF0ZVxyXG4gICAgICogQHJldHVybiB7bnVtYmVyfSAtLSBmcm9tIDAtNTlcclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCBnZXRNaW51dGVzKCBkYXRlOiBUICk6IG51bWJlcjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCB0aGUgc2Vjb25kcyBvZiB0aGUgZ2l2ZW4gZGF0ZVxyXG4gICAgICogQHBhcmFtIGRhdGVcclxuICAgICAqIEByZXR1cm4ge251bWJlcn0gLS0gZnJvbSAwLTU5XHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3QgZ2V0U2Vjb25kcyggZGF0ZTogVCApOiBudW1iZXI7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIG1pbGxpc2Vjb25kcyB0aW1lc3RhbXAgb2YgdGhlIGdpdmVuIGRhdGVcclxuICAgICAqIEBwYXJhbSAgZGF0ZVxyXG4gICAgICogQHJldHVybiB7bnVtYmVyfVxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IGdldFRpbWUoIGRhdGU6IFQgKTogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgbnVtYmVyIG9mIGRheXMgaW4gdGhlIG1vbnRoIG9mIHRoZSBnaXZlbiBkYXRlLlxyXG4gICAgICogQHBhcmFtIGRhdGUgLS0gVGhlIGRhdGUgd2hvc2UgbW9udGggc2hvdWxkIGJlIGNoZWNrZWQuXHJcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IC0tIFRoZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgbW9udGggb2YgdGhlIGdpdmVuIGRhdGUuXHJcbiAgICAgKi9cclxuICAgIGFic3RyYWN0IGdldE51bURheXNJbk1vbnRoKCBkYXRlOiBUICk6IG51bWJlcjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCB0aGUgbnVtYmVyIG9mIGNhbGVuZGFyIGRheXMgYmV0d2VlbiB0aGUgZ2l2ZW4gZGF0ZXMuXHJcbiAgICAgKiBJZiBkYXRlTGVmdCBpcyBiZWZvcmUgZGF0ZVJpZ2h0LCBpdCB3b3VsZCByZXR1cm4gcG9zaXRpdmUgdmFsdWVcclxuICAgICAqIElmIGRhdGVMZWZ0IGlzIGFmdGVyIGRhdGVSaWdodCwgaXQgd291bGQgcmV0dXJuIG5lZ2F0aXZlIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0gZGF0ZUxlZnQgLS0gdGhlIGZpcnN0IGRhdGVcclxuICAgICAqIEBwYXJhbSBkYXRlUmlnaHQgLS0gdGhlIHNlY29uZCBkYXRlXHJcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IC0tIHRoZSBudW1iZXIgb2YgY2FsZW5kYXIgZGF5cyBiZXR3ZWVuIHR3byBnaXZlbiBkYXRlc1xyXG4gICAgICpcclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCBkaWZmZXJlbmNlSW5DYWxlbmRhckRheXMoIGRhdGVMZWZ0OiBULCBkYXRlUmlnaHQ6IFQgKTogbnVtYmVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgbmFtZSBmb3IgdGhlIHllYXIgb2YgdGhlIGdpdmVuIGRhdGUuXHJcbiAgICAgKiBAcGFyYW0gZGF0ZSBUaGUgZGF0ZSB0byBnZXQgdGhlIHllYXIgbmFtZSBmb3IuXHJcbiAgICAgKiBAcmV0dXJucyBUaGUgbmFtZSBvZiB0aGUgZ2l2ZW4geWVhciAoZS5nLiAnMjAxNycpLlxyXG4gICAgICovXHJcbiAgICBhYnN0cmFjdCBnZXRZZWFyTmFtZSggZGF0ZTogVCApOiBzdHJpbmc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYSBsaXN0IG9mIG1vbnRoIG5hbWVzXHJcbiAgICAgKiBAcGFyYW0geydsb25nJyB8ICdzaG9ydCcgfCAnbmFycm93J30gc3R5bGUgLS0gZS5nLiBsb25nID0gJ0phbnVhcnknLCBzaG9ydCA9ICdKYW4nLCBuYXJyb3cgPSAnSidcclxuICAgICAqIEByZXR1cm4ge3N0cmluZ1tdfSAtLSBBbiBvcmRlcmVkIGxpc3Qgb2YgYWxsIG1vbnRoIG5hbWVzLCBzdGFydGluZyB3aXRoIEphbnVhcnkuXHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3QgZ2V0TW9udGhOYW1lcyggc3R5bGU6ICdsb25nJyB8ICdzaG9ydCcgfCAnbmFycm93JyApOiBzdHJpbmdbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCBhIGxpc3Qgb2Ygd2VlayBuYW1lc1xyXG4gICAgICogQHBhcmFtIHsnbG9uZycgfCAnc2hvcnQnIHwgJ25hcnJvdyd9IHN0eWxlIC0tIGUuZy4gbG9uZyA9ICdTdW5kYXknLCBzaG9ydCA9ICdTdW4nLCBuYXJyb3cgPSAnUydcclxuICAgICAqIEByZXR1cm4ge3N0cmluZ1tdfSAtLSBBbiBvcmRlcmVkIGxpc3Qgb2YgYWxsIHdlZWsgbmFtZXMsIHN0YXJ0aW5nIHdpdGggU3VuZGF5LlxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IGdldERheU9mV2Vla05hbWVzKCBzdHlsZTogJ2xvbmcnIHwgJ3Nob3J0JyB8ICduYXJyb3cnICk6IHN0cmluZ1tdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIGxpc3Qgb2YgbmFtZXMgZm9yIHRoZSBkYXRlcyBvZiB0aGUgbW9udGguXHJcbiAgICAgKiBAcmV0dXJucyBBbiBvcmRlcmVkIGxpc3Qgb2YgYWxsIGRhdGUgb2YgdGhlIG1vbnRoIG5hbWVzLCBzdGFydGluZyB3aXRoICcxJy5cclxuICAgICAqL1xyXG4gICAgYWJzdHJhY3QgZ2V0RGF0ZU5hbWVzKCk6IHN0cmluZ1tdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGEgRGF0ZSBvYmplY3QgYXMgYSBzdHJpbmcsIHVzaW5nIHRoZSBJU08gc3RhbmRhcmRcclxuICAgICAqIEBwYXJhbSBkYXRlIC0tIFRoZSBkYXRlIHRvIGdldCB0aGUgSVNPIGRhdGUgc3RyaW5nIGZvci5cclxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gLS0gVGhlIElTTyBkYXRlIHN0cmluZyBkYXRlIHN0cmluZy5cclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCB0b0lzbzg2MDEoIGRhdGU6IFQgKTogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2sgaWYgdGhlIGdpdmUgZGF0ZXMgYXJlIGVxdWFsXHJcbiAgICAgKiBAcGFyYW0gZGF0ZUxlZnRcclxuICAgICAqIEBwYXJhbSBkYXRlUmlnaHRcclxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3QgaXNFcXVhbCggZGF0ZUxlZnQ6IFQsIGRhdGVSaWdodDogVCApOiBib29sZWFuO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2sgaWYgdGhlIGdpdmUgZGF0ZXMgYXJlIHRoZSBzYW1lIGRheVxyXG4gICAgICogQHBhcmFtIHtEYXRlfSBkYXRlTGVmdFxyXG4gICAgICogQHBhcmFtIHtEYXRlfSBkYXRlUmlnaHRcclxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59XHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3QgaXNTYW1lRGF5KCBkYXRlTGVmdDogVCwgZGF0ZVJpZ2h0OiBUICk6IGJvb2xlYW47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gZGF0ZSBpcyB2YWxpZC5cclxuICAgICAqIEBwYXJhbSBkYXRlIFRoZSBkYXRlIHRvIGNoZWNrLlxyXG4gICAgICogQHJldHVybnMgV2hldGhlciB0aGUgZGF0ZSBpcyB2YWxpZC5cclxuICAgICAqL1xyXG4gICAgYWJzdHJhY3QgaXNWYWxpZCggZGF0ZTogVCApOiBib29sZWFuO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBkYXRlIGluc3RhbmNlIHRoYXQgaXMgbm90IHZhbGlkLlxyXG4gICAgICogQHJldHVybnMgQW4gaW52YWxpZCBkYXRlLlxyXG4gICAgICovXHJcbiAgICBhYnN0cmFjdCBpbnZhbGlkKCk6IFQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gb2JqZWN0IGlzIGNvbnNpZGVyZWQgYSBkYXRlIGluc3RhbmNlIGJ5IHRoaXMgRGF0ZVRpbWVBZGFwdGVyLlxyXG4gICAgICogQHBhcmFtIG9iaiBUaGUgb2JqZWN0IHRvIGNoZWNrXHJcbiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBvYmplY3QgaXMgYSBkYXRlIGluc3RhbmNlLlxyXG4gICAgICovXHJcbiAgICBhYnN0cmFjdCBpc0RhdGVJbnN0YW5jZSggb2JqOiBhbnkgKTogYm9vbGVhbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiB5ZWFycyB0byB0aGUgZ2l2ZW4gZGF0ZVxyXG4gICAgICogQHBhcmFtIGRhdGUgLS0gVGhlIGRhdGUgdG8gYWRkIHllYXJzIHRvLlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCAtLSBUaGUgbnVtYmVyIG9mIHllYXJzIHRvIGFkZCAobWF5IGJlIG5lZ2F0aXZlKS5cclxuICAgICAqIEByZXR1cm5zIEEgbmV3IGRhdGUgZXF1YWwgdG8gdGhlIGdpdmVuIG9uZSB3aXRoIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIHllYXJzIGFkZGVkLlxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IGFkZENhbGVuZGFyWWVhcnMoIGRhdGU6IFQsIGFtb3VudDogbnVtYmVyICk6IFQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGQgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgbW9udGhzIHRvIHRoZSBnaXZlbiBkYXRlXHJcbiAgICAgKiBAcGFyYW0gZGF0ZSAtLSBUaGUgZGF0ZSB0byBhZGQgbW9udGhzIHRvLlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCAtLSBUaGUgbnVtYmVyIG9mIG1vbnRocyB0byBhZGQgKG1heSBiZSBuZWdhdGl2ZSkuXHJcbiAgICAgKiBAcmV0dXJuIEEgbmV3IGRhdGUgZXF1YWwgdG8gdGhlIGdpdmVuIG9uZSB3aXRoIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIG1vbnRocyBhZGRlZC5cclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCBhZGRDYWxlbmRhck1vbnRocyggZGF0ZTogVCwgYW1vdW50OiBudW1iZXIgKTogVDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiBkYXlzIHRvIHRoZSBnaXZlbiBkYXRlXHJcbiAgICAgKiBAcGFyYW0gZGF0ZSAtLSBUaGUgZGF0ZSB0byBhZGQgZGF5cyB0by5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgLS0gVGhlIG51bWJlciBvZiBkYXlzIHRvIGFkZCAobWF5IGJlIG5lZ2F0aXZlKS5cclxuICAgICAqIEByZXR1cm4gQSBuZXcgZGF0ZSBlcXVhbCB0byB0aGUgZ2l2ZW4gb25lIHdpdGggdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgZGF5cyBhZGRlZC5cclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCBhZGRDYWxlbmRhckRheXMoIGRhdGU6IFQsIGFtb3VudDogbnVtYmVyICk6IFQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIGhvdXJzIHRvIHRoZSBnaXZlbiBkYXRlLlxyXG4gICAgICogQHBhcmFtIGRhdGUgLS0gVGhlIGRhdGUgdG8gc2V0IGhvdXJzIHRvLlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCAtLSBUaGUgbnVtYmVyIG9mIGhvdXJzIHRvIHNldCAoMCAtIDIzKS5cclxuICAgICAqIEByZXR1cm4gQSBuZXcgZGF0ZSBlcXVhbCB0byB0aGUgZ2l2ZW4gb25lIHdpdGggdGhlIHNwZWNpZmllZCBob3VyIHZhbHVlXHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3Qgc2V0SG91cnMoIGRhdGU6IFQsIGFtb3VudDogbnVtYmVyICk6IFQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIG1pbnV0ZXMgdG8gdGhlIGdpdmVuIGRhdGUuXHJcbiAgICAgKiBAcGFyYW0gZGF0ZSAtLSBUaGUgZGF0ZSB0byBzZXQgbWludXRlcyB0by5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgLS0gVGhlIG51bWJlciBvZiBtaW51dGVzIHRvIHNldCAoMCAtIDU5KS5cclxuICAgICAqIEByZXR1cm4gQSBuZXcgZGF0ZSBlcXVhbCB0byB0aGUgZ2l2ZW4gb25lIHdpdGggdGhlIHNwZWNpZmllZCBtaW51dGUgdmFsdWVcclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCBzZXRNaW51dGVzKCBkYXRlOiBULCBhbW91bnQ6IG51bWJlciApOiBUO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0IHRoZSBzZWNvbmRzIHRvIHRoZSBnaXZlbiBkYXRlLlxyXG4gICAgICogQHBhcmFtIGRhdGUgLS0gVGhlIGRhdGUgdG8gc2V0IHNlY29uZHMgdG8uXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYW1vdW50IC0tIFRoZSBudW1iZXIgb2Ygc2Vjb25kcyB0byBzZXQgKDAgLSA1OSkuXHJcbiAgICAgKiBAcmV0dXJuIEEgbmV3IGRhdGUgZXF1YWwgdG8gdGhlIGdpdmVuIG9uZSB3aXRoIHRoZSBzcGVjaWZpZWQgc2Vjb25kIHZhbHVlXHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3Qgc2V0U2Vjb25kcyggZGF0ZTogVCwgYW1vdW50OiBudW1iZXIgKTogVDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBkYXRlIHdpdGggdGhlIGdpdmVuIHllYXIsIG1vbnRoLCBkYXRlLCBob3VyLCBtaW51dGUgYW5kIHNlY29uZC4gRG9lcyBub3QgYWxsb3cgb3Zlci91bmRlci1mbG93IG9mIHRoZVxyXG4gICAgICogbW9udGggYW5kIGRhdGUuXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geWVhciAtLSBUaGUgZnVsbCB5ZWFyIG9mIHRoZSBkYXRlLiAoZS5nLiA4OSBtZWFucyB0aGUgeWVhciA4OSwgbm90IHRoZSB5ZWFyIDE5ODkpLlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IG1vbnRoIC0tIFRoZSBtb250aCBvZiB0aGUgZGF0ZSAoMC1pbmRleGVkLCAwID0gSmFudWFyeSkuIE11c3QgYmUgYW4gaW50ZWdlciAwIC0gMTEuXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZGF0ZSAtLSBUaGUgZGF0ZSBvZiBtb250aCBvZiB0aGUgZGF0ZS4gTXVzdCBiZSBhbiBpbnRlZ2VyIDEgLSBsZW5ndGggb2YgdGhlIGdpdmVuIG1vbnRoLlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGhvdXJzIC0tIFRoZSBob3VycyBvZiB0aGUgZGF0ZS4gTXVzdCAwIC0gMjNcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtaW51dGVzIC0tIFRoZSBtaW51dGVzIG9mIHRoZSBkYXRlLiBNdXN0IDAgLSA1OVxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHNlY29uZHMgLS0gVGhlIHNlY29uZHMgb2YgdGhlIGRhdGUuIE11c3QgMCAtIDU5XHJcbiAgICAgKiBAcmV0dXJucyBUaGUgbmV3IGRhdGUsIG9yIG51bGwgaWYgaW52YWxpZC5cclxuICAgICAqL1xyXG4gICAgYWJzdHJhY3QgY3JlYXRlRGF0ZSggeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyLCBkYXRlOiBudW1iZXIgKTogVDtcclxuICAgIGFic3RyYWN0IGNyZWF0ZURhdGUoIHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlciwgZGF0ZTogbnVtYmVyLCBob3VyczogbnVtYmVyLCBtaW51dGVzOiBudW1iZXIsIHNlY29uZHM6IG51bWJlciApOiBUO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2xvbmUgdGhlIGdpdmVuIGRhdGVcclxuICAgICAqIEBwYXJhbSBkYXRlIC0tIFRoZSBkYXRlIHRvIGNsb25lXHJcbiAgICAgKiBAcmV0dXJuIGEgbmV3IGRhdGUgb2JqZWN0IGVxdWFsIHRvIHRoZSBnaXZlbiBvbmVcclxuICAgICAqICovXHJcbiAgICBhYnN0cmFjdCBjbG9uZSggZGF0ZTogVCApOiBUO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGEgbmV3IG1vbWVudFxyXG4gICAgICogQHJldHVybiBhIGRhdGUgb2JqZWN0IHdpdGggbm93IHZhbHVlXHJcbiAgICAgKiAqL1xyXG4gICAgYWJzdHJhY3Qgbm93KCk6IFQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGb3JtYXRzIGEgZGF0ZSBhcyBhIHN0cmluZyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIGZvcm1hdC5cclxuICAgICAqIEBwYXJhbSBkYXRlIC0tIFRoZSB2YWx1ZSB0byBmb3JtYXQuXHJcbiAgICAgKiBAcGFyYW0gZGlzcGxheUZvcm1hdCAtLSBUaGUgZm9ybWF0IHRvIHVzZSB0byBkaXNwbGF5IHRoZSBkYXRlIGFzIGEgc3RyaW5nLlxyXG4gICAgICogQHJldHVybnMgVGhlIGZvcm1hdHRlZCBkYXRlIHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgYWJzdHJhY3QgZm9ybWF0KCBkYXRlOiBULCBkaXNwbGF5Rm9ybWF0OiBhbnkgKTogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGFyc2UgYSB1c2VyLXByb3ZpZGVkIHZhbHVlIHRvIGEgRGF0ZSBPYmplY3RcclxuICAgICAqIEBwYXJhbSB2YWx1ZSAtLSBUaGUgdmFsdWUgdG8gcGFyc2VcclxuICAgICAqIEBwYXJhbSB7YW55fSBwYXJzZUZvcm1hdCAtLSBUaGUgZXhwZWN0ZWQgZm9ybWF0IG9mIHRoZSB2YWx1ZSBiZWluZyBwYXJzZWRcclxuICAgICAqIEByZXR1cm4gVGhhciBwYXJzZWQgZGF0ZVxyXG4gICAgICogKi9cclxuICAgIGFic3RyYWN0IHBhcnNlKCB2YWx1ZTogYW55LCBwYXJzZUZvcm1hdDogYW55ICk6IFQgfCBudWxsO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ29tcGFyZSB0d28gZ2l2ZW4gZGF0ZXNcclxuICAgICAqIEByZXR1cm4ge251bWJlcn0gLS0gMSwgMCBvciAtMVxyXG4gICAgICogMSBpZiB0aGUgZmlyc3QgZGF0ZSBpcyBhZnRlciB0aGUgc2Vjb25kLFxyXG4gICAgICogLTEgaWYgdGhlIGZpcnN0IGRhdGUgaXMgYmVmb3JlIHRoZSBzZWNvbmRcclxuICAgICAqIDAgaWYgZGF0ZXMgYXJlIGVxdWFsLlxyXG4gICAgICogKi9cclxuICAgIGNvbXBhcmUoIGZpcnN0OiBULCBzZWNvbmQ6IFQgKTogbnVtYmVyIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZChmaXJzdCkgfHwgIXRoaXMuaXNWYWxpZChzZWNvbmQpKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdKU05hdGl2ZURhdGU6IENhbm5vdCBjb21wYXJlIGludmFsaWQgZGF0ZXMuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkYXRlRmlyc3QgPSB0aGlzLmNsb25lKGZpcnN0KTtcclxuICAgICAgICBjb25zdCBkYXRlU2Vjb25kID0gdGhpcy5jbG9uZShzZWNvbmQpO1xyXG5cclxuICAgICAgICBjb25zdCBkaWZmID0gdGhpcy5nZXRUaW1lKGRhdGVGaXJzdCkgLSB0aGlzLmdldFRpbWUoZGF0ZVNlY29uZCk7XHJcblxyXG4gICAgICAgIGlmIChkaWZmIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaWZmID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBSZXR1cm4gMCBpZiBkaWZmIGlzIDA7IHJldHVybiBOYU4gaWYgZGlmZiBpcyBOYU5cclxuICAgICAgICAgICAgcmV0dXJuIGRpZmY7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2sgaWYgdHdvIGdpdmVuIGRhdGVzIGFyZSBpbiB0aGUgc2FtZSB5ZWFyXHJcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IC0tIDEsIDAgb3IgLTFcclxuICAgICAqIDEgaWYgdGhlIGZpcnN0IGRhdGUncyB5ZWFyIGlzIGFmdGVyIHRoZSBzZWNvbmQsXHJcbiAgICAgKiAtMSBpZiB0aGUgZmlyc3QgZGF0ZSdzIHllYXIgaXMgYmVmb3JlIHRoZSBzZWNvbmRcclxuICAgICAqIDAgaWYgdHdvIGdpdmVuIGRhdGVzIGFyZSBpbiB0aGUgc2FtZSB5ZWFyXHJcbiAgICAgKiAqL1xyXG4gICAgY29tcGFyZVllYXIoIGZpcnN0OiBULCBzZWNvbmQ6IFQgKTogbnVtYmVyIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQoZmlyc3QpIHx8ICF0aGlzLmlzVmFsaWQoc2Vjb25kKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignSlNOYXRpdmVEYXRlOiBDYW5ub3QgY29tcGFyZSBpbnZhbGlkIGRhdGVzLicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgeWVhckxlZnQgPSB0aGlzLmdldFllYXIoZmlyc3QpO1xyXG4gICAgICAgIGNvbnN0IHllYXJSaWdodCA9IHRoaXMuZ2V0WWVhcihzZWNvbmQpO1xyXG5cclxuICAgICAgICBjb25zdCBkaWZmID0geWVhckxlZnQgLSB5ZWFyUmlnaHQ7XHJcblxyXG4gICAgICAgIGlmIChkaWZmIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaWZmID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBdHRlbXB0cyB0byBkZXNlcmlhbGl6ZSBhIHZhbHVlIHRvIGEgdmFsaWQgZGF0ZSBvYmplY3QuIFRoaXMgaXMgZGlmZmVyZW50IGZyb20gcGFyc2luZyBpbiB0aGF0XHJcbiAgICAgKiBkZXNlcmlhbGl6ZSBzaG91bGQgb25seSBhY2NlcHQgbm9uLWFtYmlndW91cywgbG9jYWxlLWluZGVwZW5kZW50IGZvcm1hdHMgKGUuZy4gYSBJU08gODYwMVxyXG4gICAgICogc3RyaW5nKS4gVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZG9lcyBub3QgYWxsb3cgYW55IGRlc2VyaWFsaXphdGlvbiwgaXQgc2ltcGx5IGNoZWNrcyB0aGF0XHJcbiAgICAgKiB0aGUgZ2l2ZW4gdmFsdWUgaXMgYWxyZWFkeSBhIHZhbGlkIGRhdGUgb2JqZWN0IG9yIG51bGwuIFRoZSBgPG1hdC1kYXRlcGlja2VyPmAgd2lsbCBjYWxsIHRoaXNcclxuICAgICAqIG1ldGhvZCBvbiBhbGwgb2YgaXQncyBgQElucHV0KClgIHByb3BlcnRpZXMgdGhhdCBhY2NlcHQgZGF0ZXMuIEl0IGlzIHRoZXJlZm9yZSBwb3NzaWJsZSB0b1xyXG4gICAgICogc3VwcG9ydCBwYXNzaW5nIHZhbHVlcyBmcm9tIHlvdXIgYmFja2VuZCBkaXJlY3RseSB0byB0aGVzZSBwcm9wZXJ0aWVzIGJ5IG92ZXJyaWRpbmcgdGhpcyBtZXRob2RcclxuICAgICAqIHRvIGFsc28gZGVzZXJpYWxpemUgdGhlIGZvcm1hdCB1c2VkIGJ5IHlvdXIgYmFja2VuZC5cclxuICAgICAqIEBwYXJhbSB2YWx1ZSBUaGUgdmFsdWUgdG8gYmUgZGVzZXJpYWxpemVkIGludG8gYSBkYXRlIG9iamVjdC5cclxuICAgICAqIEByZXR1cm5zIFRoZSBkZXNlcmlhbGl6ZWQgZGF0ZSBvYmplY3QsIGVpdGhlciBhIHZhbGlkIGRhdGUsIG51bGwgaWYgdGhlIHZhbHVlIGNhbiBiZVxyXG4gICAgICogICAgIGRlc2VyaWFsaXplZCBpbnRvIGEgbnVsbCBkYXRlIChlLmcuIHRoZSBlbXB0eSBzdHJpbmcpLCBvciBhbiBpbnZhbGlkIGRhdGUuXHJcbiAgICAgKi9cclxuICAgIGRlc2VyaWFsaXplKCB2YWx1ZTogYW55ICk6IFQgfCBudWxsIHtcclxuICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB0aGlzLmlzRGF0ZUluc3RhbmNlKHZhbHVlKSAmJiB0aGlzLmlzVmFsaWQodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW52YWxpZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyB0aGUgbG9jYWxlIHVzZWQgZm9yIGFsbCBkYXRlcy5cclxuICAgICAqIEBwYXJhbSBsb2NhbGUgVGhlIG5ldyBsb2NhbGUuXHJcbiAgICAgKi9cclxuICAgIHNldExvY2FsZSggbG9jYWxlOiBhbnkgKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhbGUgPSBsb2NhbGU7XHJcbiAgICAgICAgdGhpcy5fbG9jYWxlQ2hhbmdlcy5uZXh0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGFtcCB0aGUgZ2l2ZW4gZGF0ZSBiZXR3ZWVuIG1pbiBhbmQgbWF4IGRhdGVzLlxyXG4gICAgICogQHBhcmFtIGRhdGUgVGhlIGRhdGUgdG8gY2xhbXAuXHJcbiAgICAgKiBAcGFyYW0gbWluIFRoZSBtaW5pbXVtIHZhbHVlIHRvIGFsbG93LiBJZiBudWxsIG9yIG9taXR0ZWQgbm8gbWluIGlzIGVuZm9yY2VkLlxyXG4gICAgICogQHBhcmFtIG1heCBUaGUgbWF4aW11bSB2YWx1ZSB0byBhbGxvdy4gSWYgbnVsbCBvciBvbWl0dGVkIG5vIG1heCBpcyBlbmZvcmNlZC5cclxuICAgICAqIEByZXR1cm5zIGBtaW5gIGlmIGBkYXRlYCBpcyBsZXNzIHRoYW4gYG1pbmAsIGBtYXhgIGlmIGRhdGUgaXMgZ3JlYXRlciB0aGFuIGBtYXhgLFxyXG4gICAgICogICAgIG90aGVyd2lzZSBgZGF0ZWAuXHJcbiAgICAgKi9cclxuICAgIGNsYW1wRGF0ZSggZGF0ZTogVCwgbWluPzogVCB8IG51bGwsIG1heD86IFQgfCBudWxsICk6IFQge1xyXG4gICAgICAgIGlmIChtaW4gJiYgdGhpcy5jb21wYXJlKGRhdGUsIG1pbikgPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtaW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYXggJiYgdGhpcy5jb21wYXJlKGRhdGUsIG1heCkgPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==